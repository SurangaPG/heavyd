<?xml version="1.0"?>

<project name="Startup tasks" default="startup:help" description="Contains all the task used to startup a new project.">

    <target name="startup:setup-profile" description="Copies over a heavyD base config profile and connected composer file to kickstart a project..">
        <property name="profile.to.use" value="default" />

        <copy todir="${project.basedir}/etc/site/default/config">
            <fileset dir="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/config-profile/${profile.to.use}/config">
                <patternset>
                    <include name="**"/>
                </patternset>
            </fileset>
        </copy>

        <!-- Copy over the connected composer.json file -->
        <copy file="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/config-profile/${profile.to.use}/composer.json"
              todir="${project.basedir}/" />
    </target>

    <target name="startup:basic-dirs" description="Set up the basic directories for a heavyD project">
        <mkdir dir="${project.basedir}/properties" />
        <mkdir dir="${project.basedir}/temp/cache" />
        <mkdir dir="${project.basedir}/temp/artifact" />
        <mkdir dir="${project.basedir}/etc" />
        <mkdir dir="${project.basedir}/etc/templates" />
        <mkdir dir="${project.basedir}/etc/stage" />
        <mkdir dir="${project.basedir}/etc/env" />
        <mkdir dir="${project.basedir}/etc/site" />
        <mkdir dir="${project.basedir}/scripts" />
        <mkdir dir="${project.basedir}/tests" />
        <mkdir dir="${project.basedir}/tests/behat" />
        <mkdir dir="${project.basedir}/tests/phpunit" />
        <mkdir dir="${project.basedir}/tests/haunt" />
    </target>

    <target name="startup:mirror-templates" description="mirrors all the template files in the .phing dir to the active site.">
        <copy todir="${project.basedir}/">
            <fileset dir="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/misc">
                <patternset>
                    <include name="**"/>
                </patternset>
            </fileset>
        </copy>

        <copy todir="${project.basedir}/web/sites/default/">
            <fileset dir="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/settings">
                <patternset>
                    <include name="**"/>
                </patternset>
            </fileset>
        </copy>

        <copy todir="${project.basedir}/properties/">
            <fileset dir="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/properties">
                <patternset>
                    <include name="**"/>
                </patternset>
            </fileset>
        </copy>

        <copy todir="${project.basedir}/">
            <fileset dir="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/update">
                <patternset>
                    <include name="**"/>
                </patternset>
            </fileset>
        </copy>
    </target>

    <target name="startup:optional-files">
        <!-- Copy over some base files if they are not present -->
        <copy file="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/optional/composer.json"
              tofile="${project.basedir}/composer.json" />

        <copy file="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/optional/.gitignore"
              tofile="${project.basedir}/.gitignore" />

        <!-- Include the baseline module and theme -->
        <if>
            <not>
                <available file='${project.basedir}/web/modules/custom/baseline' type='dir' property="exists.baseline.module"/>
            </not>

            <then>
                <echo message="Baseline module doesn't exist, adding it." />
                <copy todir="${project.basedir}/web/modules/custom/baseline">
                    <fileset dir="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/optional/baseline">
                        <patternset>
                            <include name="**"/>
                        </patternset>
                    </fileset>
                </copy>
            </then>
            <else>
                <echo message="Baseline module already present." />
            </else>
        </if>

        <!-- Include the build.xml file -->
        <if>
            <not>
                <available file='${project.basedir}/build.xml' property="exists.buildxml"/>
            </not>

            <then>
                <echo message="build.xml doesn't exist, adding it." />
                <copy tofile="${project.basedir}/build.xml" file="{project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/optional/build.xml" />
            </then>
            <else>
                <echo message="build.xml already present." />
            </else>
        </if>

        <if>
            <not>
                <available file='${project.basedir}/web/themes/custom/baseline_style' type='dir' property="exists.baseline.theme"/>
            </not>

            <then>
                <echo message="Baseline theme doesn't exist, adding it." />
                <echo message="${exists.baseline.theme}" />
                <copy todir="${project.basedir}/web/themes/custom/baseline_style">
                    <fileset dir="${project.basedir}/.heavyd/vendor/heavyd/platform/templates/startup/optional/baseline_style">
                        <patternset>
                            <include name="**"/>
                        </patternset>
                    </fileset>
                </copy>
            </then>
            <else>
                <echo message="Baseline theme already present." />
            </else>
        </if>
    </target>
</project>